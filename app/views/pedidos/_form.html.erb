<%= nested_form_for @pedido, :html => { :class => 'validate' } do |f| %>

  <% if @pedido.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@pedido.errors.count, "error") %>:</h2>

      <ul>
      <% @pedido.errors.full_messages.each do |msg| %>
        <li><%= msg %></li><br/>
      <% end %>
      </ul>
    </div>
<% end %>
  <table>
 <% if can? :manage, Proteina %>
  <p>
    <%= f.label :cliente_id, :class => 'control-label' %>
    <%= f.collection_select :cliente_id, Cliente.all, :id, :nome, :prompt => "Selecione", :class => 'text_field' %>
    </p>
  <% end %>
<!--   <p>
  <fieldset class="form-clientes pess">
  <legend>Acompanhamentos</legend>
 -->    <%# @entradas_disponiveis.each do |entrada| %>
    <%#= collection_check_boxes(:pedido, :acompanhamento_ids, @acompanhamentos_disponiveis, :id, :nome) %>
      <%#= check_box_tag 'pedido[entrada][]', "#{entrada.nome}", @pedido.entradas.includefalse, :value => "#{entrada.nome}" %>
      <%#= label :entrada, "#{entrada.nome}", :class =>"radio inline" %>
    <%# end %>
<!-- </fieldset>
    </p>
 -->
  <p>

  <fieldset class="form-clientes pess">
  <legend>Acompanhamentos</legend>
    <% @acompanhamentos_disponiveis.each_with_index do |acompanhamento,i| %>
    <%# debugger %>
      <%#= collection_check_boxes :pedido, :proteina_ids, @proteinas_disponiveis, :id, :nome %>
      <%#= check_box_tag "acompanhamento_#{i}", "#{acompanhamento.nome}", (@pedido.acompanhamentos.include? acompanhamento ? true : false), :value => "#{acompanhamento.id}" %>
      <%#= "#{acompanhamento.nome}" %>
      <% if !@pedido.acompanhamentos.include? acompanhamento %>
      <%= check_box_tag "acompanhamento_#{i}", "#{acompanhamento.nome}", false, :value => "#{acompanhamento.id}" %>
      <%= "#{acompanhamento.nome}" %>
      <%= select_tag "quantidade_acompanhamento_#{i}", options_for_select((1..3).map{|s| ["#{s}", s]}), :prompt => "Selecione" %>
      <% else %>
      <%= check_box_tag "acompanhamento_#{i}", "#{acompanhamento.nome}", true, :value => "#{acompanhamento.id}" %>
      <%= "#{acompanhamento.nome}" %>
      <%= select_tag "quantidade_acompanhamento_#{i}", options_for_select((1..3).map{|s| ["#{s}", s]}, :selected => @pedido.pedidos_acompanhamentos.where(:acompanhamento_id => acompanhamento.id).first.quantidade), :prompt => "Selecione" %>
      <% end %>
      <%#= select_field_tag "quantidade_#{i}" %>
    <% end %>
</fieldset>
  </p>


  <p>

  <fieldset class="form-clientes pess">
  <legend>Proteínas</legend>
    <% @proteinas_disponiveis.each_with_index do |proteina,i| %>
    <%# debugger %>
      <%#= collection_check_boxes :pedido, :proteina_ids, @proteinas_disponiveis, :id, :nome %>
      <%#= check_box_tag "proteina_#{i}", "#{proteina.nome}", false, :value => "#{proteina.id}" %>
      <%#= "#{proteina.nome}" %>
      <% if !@pedido.proteinas.include? proteina %>
      <%# if @pedido.pedidos_proteinas["#{i}".to_i].nil? %>
      <%= check_box_tag "proteina_#{i}", "#{proteina.nome}", false, :value => "#{proteina.id}" %>
      <%= "#{proteina.nome}" %>
      <%= select_tag "quantidade_proteina_#{i}", options_for_select((1.."#{proteina.quantidade}".to_i).map{|s| ["#{s}", s]}), :prompt => "Selecione" %>
      <% else %>
      <%= check_box_tag "proteina_#{i}", "#{proteina.nome}", true, :value => "#{proteina.id}" %>
      <%= "#{proteina.nome}" %>      
      <%= select_tag "quantidade_proteina_#{i}", options_for_select((1.."#{proteina.quantidade}".to_i).map{|s| ["#{s}", s]}, :selected => @pedido.pedidos_proteinas.where(:proteina_id => proteina.id).first.quantidade), :prompt => "Selecione" %>
      <% end %>
      <%#= select_field_tag "quantidade_#{i}" %>
    <% end %>
</fieldset>
  </p>

<p>

  <fieldset class="form-clientes pess">
  <legend>Guarnições</legend>
    <% @guarnicoes_disponiveis.each_with_index do |guarnicao,i| %>
    <%# debugger %>
      <%#= collection_check_boxes :pedido, :proteina_ids, @proteinas_disponiveis, :id, :nome %>
      <%#= check_box_tag "proteina_#{i}", "#{proteina.nome}", false, :value => "#{proteina.id}" %>
      <%#= "#{proteina.nome}" %>
      <% if !@pedido.guarnicoes.include? guarnicao %>
      <%# if @pedido.pedidos_proteinas["#{i}".to_i].nil? %>
      <%= check_box_tag "guarnicao_#{i}", "#{guarnicao.nome}", false, :value => "#{guarnicao.id}" %>
      <%= "#{guarnicao.nome}" %>
      <%= select_tag "quantidade_guarnicao_#{i}", options_for_select((1.."#{guarnicao.quantidade}".to_i).map{|s| ["#{s}", s]}), :prompt => "Selecione" %>
      <% else %>
      <%= check_box_tag "guarnicao_#{i}", "#{guarnicao.nome}", true, :value => "#{guarnicao.id}" %>
      <%= "#{guarnicao.nome}" %>      
      <%= select_tag "quantidade_guarnicao_#{i}", options_for_select((1.."#{guarnicao.quantidade}".to_i).map{|s| ["#{s}", s]}, :selected => @pedido.pedidos_guarnicoes.where(:guarnicao_id => guarnicao.id).first.quantidade), :prompt => "Selecione" %>
      <% end %>
      <%#= select_field_tag "quantidade_#{i}" %>
    <% end %>
</fieldset>
  </p>

<p>

  <fieldset class="form-clientes pess">
  <legend>Saladas</legend>
    <% @saladas_disponiveis.each_with_index do |salada,i| %>
    <%# debugger %>
      <%#= collection_check_boxes :pedido, :proteina_ids, @proteinas_disponiveis, :id, :nome %>
      <%#= check_box_tag "proteina_#{i}", "#{proteina.nome}", false, :value => "#{proteina.id}" %>
      <%#= "#{proteina.nome}" %>
      <% if !@pedido.saladas.include? salada %>
      <%# if @pedido.pedidos_proteinas["#{i}".to_i].nil? %>
      <%= check_box_tag "salada_#{i}", "#{salada.nome}", false, :value => "#{salada.id}" %>
      <%= "#{salada.nome}" %>
      <%= select_tag "quantidade_salada_#{i}", options_for_select((1.."#{salada.quantidade}".to_i).map{|s| ["#{s}", s]}), :prompt => "Selecione" %>
      <% else %>
      <%= check_box_tag "salada_#{i}", "#{salada.nome}", true, :value => "#{salada.id}" %>
      <%= "#{salada.nome}" %>      
      <%= select_tag "quantidade_salada_#{i}", options_for_select((1.."#{salada.quantidade}".to_i).map{|s| ["#{s}", s]}, :selected => @pedido.pedidos_saladas.where(:salada_id => salada.id).first.quantidade), :prompt => "Selecione" %>
      <% end %>
      <%#= select_field_tag "quantidade_#{i}" %>
    <% end %>
</fieldset>
  </p>

<!--   <p>
<fieldset>
      <div class="control-group">
      <%#= f.fields_for :pedidos_acompanhamentos do |pedido_acompanhamento| %>
    <%# @acompanhamentos_disponiveis.each_with_index do |acompanhamento,i| %>
    <%# debugger %>
      <%#= collection_check_boxes :pedido, :proteina_ids, @proteinas_disponiveis, :id, :nome %>
      <%#= pedido_acompanhamento.check_box :acompanhamento_id, :value => "#{acompanhamento.id}" %>
      <%#= "#{acompanhamento.nome}" %>
      <%#= pedido_acompanhamento.select "quantidade", options_for_select((1..3).map{|s| ["#{s}", s]}), :prompt => "Selecione" %>
      <%#= select_field_tag "quantidade_#{i}" %>
    <%# end %>
<%# end %>
</fieldset>
      <div class="controls">
</div>
</div>
</p>
 -->

  <p>
  <fieldset class="form-clientes pess">
  <legend>Produtos</legend>
      <div class="control-group">
      <%= f.fields_for :item_de_pedidos do |item| %>
      <div class="controls">
      <%= item.collection_select :produto_id, Produto.bebidas, :id, :exibicao_select, :prompt => "Nenhuma", :class => 'text_field' %>
      <%= item.select :quantidade, options_for_select([['0', 0], ['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5], ['6', 6], ['7', 7], ['8', 8], ['9', 9], ['10',10]], :selected => item.object.quantidade), :prompt => 0, :class => 'select_field' %>
      <%= item.link_to_remove "Remover este item" %>
    <% end %>
<p><%= f.link_to_add "Adicionar Item", :item_de_pedidos %></p>
</div>
</div>
</fieldset>
</p>
  <p>
<br>
    <%= f.submit nil, :class => 'button blue-cadastrar-top' %>
    <%= link_to "Cancelar", pedidos_path, :class => 'button gray-voltar' %>
</p>
</table>

<% end %>
